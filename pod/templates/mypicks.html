{% extends "layout.html" %}
{% block content1  %}
<h2 class="display-4 mb-4">{{current_user.firstname}}'s Picks</h2>
<form method="POST" class="form-inline">
  <div>
  {% if form.sport.errors %}
    {{ form.sport(class ="form-control is-invalid") }}
    <div class="invalid-feedback">
      {% for error in form.sport.errors %}
        <span>{{ error }}</span>
      {% endfor %}
    </div>
  {% else %}
    {{ form.sport(class="form-control") }}
  {% endif %}

  {% if form.team.errors %}
    {{ form.team(class ="form-control is-invalid")}}
    <div class="invalid-feedback">
      {% for error in form.team.errors %}
        <span>{{ error }}</span>
      {% endfor %}
    </div>
  {% else %}
    {{ form.team(class="form-control") }}
  {% endif %}

  {% if form.linetype.errors %}
    {{ form.linetype(class ="form-control is-invalid") }}
    <div class="invalid-feedback">
      {% for error in form.linetype.errors %}
        <span>{{ error }}</span>
      {% endfor %}
    </div>
  {% else %}
    {{ form.linetype(class="form-control") }}
  {% endif %}

  {% if form.line.errors %}
    {{ form.line(class ="form-control is-invalid") }}
    <div class="invalid-feedback">
      {% for error in form.line.errors %}
        <span>{{ error }}</span>
      {% endfor %}
    </div>
  {% else %}
    {{ form.line(class="form-control") }}
  {% endif %}
  {# {{ form.date }} #}
  </div>
  <input type="submit">
</form>
<script type="text/javascript" src="{{ url_for('static', filename='updatelist.js') }}"></script>
{% endblock content1 %}




{% block content2 %}

<div class="table-responsive">
  <table class="table">
    <thead>
      <th scope="col">Sport</th>
      <th scope="col">Line Type</th>
      <th scope="col">Team</th>
      <th scope="col">Line</th>
    </thead>
      {% set skip_list = [] %}
      {% for pick in picks %}
        {# If we have already seen this pick from another member of the parlay, don't print it #}
        {% if pick.id in skip_list %}
        {# Do nothing #}
        {% else %}
          {# If it's not a parlayed pick print it normally #}
          {% if pick.parlay_id == None %}
            <tr>
              <td>{{pick.sport}}</td>
              <td>{{pick.linetype}}</td>
              <td>{{pick.team}}</td>
              <td>{{pick.line}}</td>
            </tr>
          {# Else, print out the paylayed pick and add the other members to the skip_list #}
          {% else %}
          <tr>
            <td>
              {% for parpick in pick.parlayobj.picks %}
                <div>{{parpick.sport}}</div>
                {% do skip_list.append(parpick.id) %}
              {% endfor %}
            </td>
            <td>
              {% for parpick in pick.parlayobj.picks %}
                <div>{{parpick.linetype}}</div>
              {% endfor %}
            </td>
            <td>
              {% for parpick in pick.parlayobj.picks %}
                <div>{{parpick.team}}</div>
              {% endfor %}
            </td>
            <td>
              {% for parpick in pick.parlayobj.picks %}
                <div>{{parpick.line}}</div>
              {% endfor %}
            </td>
          </tr>
          {% endif %}
        {% endif %}
      {% endfor %}
  </table>
</div>

{% endblock content2 %}
